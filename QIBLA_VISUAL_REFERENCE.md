# Qibla Feature - Quick Visual Reference

## ğŸ§­ Qibla Screen Layout

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  â† Back    Qibla Direction         âšª   â”‚  â† Header
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                         â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚ ğŸ“ Cairo, Egypt                   â”‚  â”‚  â† Location Info
â”‚  â”‚ ğŸ§­ 1,234 km to Kaaba              â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                         â”‚
â”‚         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”             â”‚
â”‚         â”‚        N        â”‚             â”‚
â”‚         â”‚                 â”‚             â”‚
â”‚         â”‚    â”Œâ”€â”€â”€â”€â”€â”     â”‚             â”‚  â† Compass Ring
â”‚         â”‚ W  â”‚ ğŸ•‹  â”‚  E  â”‚             â”‚    (240Ã—240px)
â”‚         â”‚    â””â”€â”€â”€â”€â”€â”˜     â”‚             â”‚
â”‚         â”‚        â†‘       â”‚             â”‚  â† Green Needle
â”‚         â”‚        S        â”‚             â”‚    (pointing to Qibla)
â”‚         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜             â”‚
â”‚                                         â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚  Facing        â”‚      Qibla       â”‚  â”‚  â† Bearing Info
â”‚  â”‚   145Â°         â”‚       67Â°        â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                         â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚ How to Use                        â”‚  â”‚  â† Instructions
â”‚  â”‚ 1. Hold device flat and level     â”‚  â”‚
â”‚  â”‚ 2. Rotate until arrow points up   â”‚  â”‚
â”‚  â”‚ 3. You're facing Qibla            â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ  Home Screen - Before vs After

### **BEFORE:**
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Daily Guidance  â”‚  Moment       â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  [Check In] [View Insights]      â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  Next Prayer  â”‚  Today's Blessingâ”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  Spiritual Modules            â–¼  â”‚  â† Collapsible section
â”‚  â”Œâ”€â”€â”€â”€â”¬â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”     â”‚
â”‚  â”‚ğŸ§®  â”‚ğŸ“œ  â”‚ğŸŒ™  â”‚ğŸ’  â”‚ğŸ•°ï¸ â”‚     â”‚  â† 5 modules in a row
â”‚  â””â”€â”€â”€â”€â”´â”€â”€â”€â”€â”´â”€â”€â”€â”€â”´â”€â”€â”€â”€â”´â”€â”€â”€â”€â”˜     â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  Quick Access                    â”‚  â† Separate section
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”‚
â”‚  â”‚ğŸ•Œ Prayer â”‚ğŸ”” Daily  â”‚         â”‚  â† 2Ã—2 grid
â”‚  â”‚  Times   â”‚ Reminder â”‚         â”‚
â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤         â”‚
â”‚  â”‚ğŸ“¿ Dhikr â”‚ğŸ§® Calc   â”‚         â”‚  â† DUPLICATE Calculator!
â”‚  â”‚  Counter â”‚          â”‚         â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### **AFTER:**
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Daily Guidance  â”‚  Moment       â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  [Check In] [View Insights]      â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  Next Prayer  â”‚  Today's Blessingâ”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  Spiritual Modules            â–¼  â”‚  â† Single unified section
â”‚  â”Œâ”€â”€â”€â”€â”¬â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”               â”‚
â”‚  â”‚ğŸ§®  â”‚ğŸ“œ  â”‚ğŸŒ™  â”‚               â”‚  â† Row 1: 3 modules
â”‚  â”œâ”€â”€â”€â”€â”¼â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”¤               â”‚
â”‚  â”‚ğŸ’  â”‚ğŸ•°ï¸ â”‚ğŸ•Œ  â”‚               â”‚  â† Row 2: 3 modules
â”‚  â”œâ”€â”€â”€â”€â”¼â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”¤               â”‚
â”‚  â”‚ğŸ§­  â”‚ğŸ“¿  â”‚    â”‚               â”‚  â† Row 3: 2 modules + space
â”‚  â””â”€â”€â”€â”€â”´â”€â”€â”€â”€â”´â”€â”€â”€â”€â”˜               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
     â†‘
   NEW Qibla tile!
```

**Changes:**
- âŒ Removed "Quick Access" section
- âŒ Removed duplicate Calculator
- âœ… Added Prayer Times to main grid
- âœ… Added Qibla (NEW feature)
- âœ… Added Dhikr Counter to main grid
- âœ… 3-column responsive layout
- âœ… More compact, less scrolling

---

## ğŸ“± Module Grid Layout

### Responsive 3-Column Grid:
```css
flexDirection: 'row'
flexWrap: 'wrap'
gap: Spacing.sm
```

Each tile:
- **Width:** 31% (3 columns with gap)
- **Min width:** 90px (prevents too small on tiny screens)
- **Icon size:** 56Ã—56px
- **Icon emoji:** 28px font size
- **Label:** 10px, centered, max 1 line

### Module List (8 total):

| # | Icon | Title | Arabic | Element | Route |
|---|------|-------|--------|---------|-------|
| 1 | ğŸ§® | Calculator | Ø­Ø§Ø³Ø¨Ø© Ø§Ù„Ø£Ø¨Ø¬Ø¯ | Fire | `/calculator` |
| 2 | ğŸ“œ | Name Destiny | Ù‚Ø¯Ø± Ø§Ù„Ø£Ø³Ù…Ø§Ø¡ | Earth | `/(tabs)/name-destiny` |
| 3 | ğŸŒ™ | Istikhara | Ø§Ù„Ø§Ø³ØªØ®Ø§Ø±Ø© | Water | `/istikhara` |
| 4 | ğŸ’ | Compatibility | Ø§Ù„ØªÙˆØ§ÙÙ‚ | Air | `/compatibility` |
| 5 | ğŸ•°ï¸ | Divine Timing | Ø§Ù„ØªÙˆÙ‚ÙŠØª Ø§Ù„Ø¥Ù„Ù‡ÙŠ | Fire | `/divine-timing` |
| 6 | ğŸ•Œ | Prayer Times | Ù…ÙˆØ§Ù‚ÙŠØª Ø§Ù„ØµÙ„Ø§Ø© | Water | `/prayer-times` |
| 7 | ğŸ§­ | **Qibla** | **Ø§Ù„Ù‚Ø¨Ù„Ø©** | Earth | `/qibla` |
| 8 | ğŸ“¿ | Dhikr Counter | Ø¹Ø¯Ø§Ø¯ Ø§Ù„Ø£Ø°ÙƒØ§Ø± | Air | `/dhikr-counter` |

---

## ğŸ¨ Design Tokens Used

### Colors:
```typescript
DarkTheme.textPrimary       // #FFFFFF
DarkTheme.textSecondary     // rgba(255, 255, 255, 0.7)
DarkTheme.textTertiary      // rgba(255, 255, 255, 0.5)
DarkTheme.cardBackground    // rgba(255, 255, 255, 0.05)
DarkTheme.accent            // #10b981 (green - for Qibla)
```

### Spacing:
```typescript
Spacing.xs           // 4px
Spacing.sm           // 8px
Spacing.md           // 16px
Spacing.lg           // 24px
Spacing.xl           // 32px
Spacing.screenPadding // 16px
```

### Typography:
```typescript
Typography.weightMedium    // 500
Typography.weightSemibold  // 600
Typography.weightBold      // 700
```

### Cards:
```typescript
borderRadius: 16
borderWidth: 1
borderColor: 'rgba(255, 255, 255, 0.1)'
backgroundColor: 'rgba(255, 255, 255, 0.05)'
```

---

## ğŸ”§ Qibla Calculations

### Bearing Formula:
```typescript
// Calculate bearing from user to Kaaba
function calculateBearing(lat1, lon1, lat2, lon2) {
  const toRadians = (deg) => (deg * Math.PI) / 180;
  const toDegrees = (rad) => (rad * 180) / Math.PI;

  const dLon = toRadians(lon2 - lon1);
  const y = Math.sin(dLon) * Math.cos(toRadians(lat2));
  const x = Math.cos(toRadians(lat1)) * Math.sin(toRadians(lat2)) -
            Math.sin(toRadians(lat1)) * Math.cos(toRadians(lat2)) * Math.cos(dLon);

  let bearing = toDegrees(Math.atan2(y, x));
  bearing = (bearing + 360) % 360;
  return bearing;
}
```

### Distance Formula (Haversine):
```typescript
function calculateDistance(lat1, lon1, lat2, lon2) {
  const R = 6371; // Earth radius in km
  const toRadians = (deg) => (deg * Math.PI) / 180;

  const dLat = toRadians(lat2 - lat1);
  const dLon = toRadians(lon2 - lon1);

  const a = Math.sin(dLat/2) * Math.sin(dLat/2) +
            Math.cos(toRadians(lat1)) * Math.cos(toRadians(lat2)) *
            Math.sin(dLon/2) * Math.sin(dLon/2);

  const c = 2 * Math.atan2(Math.sqrt(a), Math.sqrt(1-a));
  return R * c;
}
```

### Relative Qibla Angle:
```typescript
// Angle to rotate compass needle
const qiblaRelative = (qiblaBearing - deviceHeading + 360) % 360;
```

---

## ğŸ“‹ Permission Flow

```
User opens Qibla screen
         â†“
Request location permission
         â†“
    â”Œâ”€â”€â”€â”€â”´â”€â”€â”€â”€â”
    â”‚         â”‚
 Granted   Denied
    â”‚         â”‚
    â†“         â†“
Get user   Show error
location   with retry
    â†“
Calculate
 Qibla
    â†“
Subscribe to
 heading
    â†“
Show compass
  (live)
```

### States:
1. **Loading**: Spinner + "Finding your location..."
2. **Permission Denied**: Icon + message + "Enable Location" button
3. **Success**: Compass + info cards
4. **No Compass Sensor**: Warning banner + static bearing

---

## ğŸŒ Translation Keys

### English:
```typescript
t('qibla.title')              â†’ "Qibla Direction"
t('qibla.yourLocation')       â†’ "Your Location"
t('qibla.facing')             â†’ "Facing"
t('qibla.qibla')              â†’ "Qibla"
t('qibla.permissionRequired') â†’ "Location Permission Required"
t('qibla.enableLocation')     â†’ "Enable Location"
t('qibla.locating')           â†’ "Finding your location..."
t('qibla.noCompass')          â†’ "Compass sensor not available..."
t('qibla.calibrate')          â†’ "Move device in figure-8..."
t('qibla.howToUse')           â†’ "How to Use"
t('qibla.instruction1')       â†’ "Hold device flat and level"
t('qibla.instruction2')       â†’ "Rotate until arrow points up"
t('qibla.instruction3')       â†’ "You're facing Qibla"
```

### French:
```typescript
t('qibla.title')              â†’ "Direction de la Qibla"
t('qibla.yourLocation')       â†’ "Votre Position"
t('qibla.facing')             â†’ "Direction"
t('qibla.qibla')              â†’ "Qibla"
// ... (same keys, French values)
```

---

## âœ… Testing Scenarios

### Home Screen:
1. âœ“ Open app â†’ See 8 modules in 3-column grid
2. âœ“ No "Quick Access" section visible
3. âœ“ Only one Calculator tile (no duplicate)
4. âœ“ Qibla tile shows ğŸ§­ icon
5. âœ“ Tap Qibla â†’ Navigate to `/qibla`
6. âœ“ Rotate device â†’ Grid wraps properly
7. âœ“ No overlap with bottom tab bar

### Qibla Screen:
1. âœ“ First launch â†’ Request location permission
2. âœ“ Deny permission â†’ Show error with retry
3. âœ“ Grant permission â†’ Show loading spinner
4. âœ“ Get location â†’ Display compass
5. âœ“ Move device â†’ Compass heading updates
6. âœ“ Needle points to Qibla (relative to heading)
7. âœ“ City name displays (if available)
8. âœ“ Distance to Kaaba shown
9. âœ“ Back button â†’ Return to Home
10. âœ“ Switch language â†’ All strings update

### Edge Cases:
- âœ“ No internet â†’ GPS still works
- âœ“ Indoors â†’ May have weak GPS signal
- âœ“ No magnetometer â†’ Show static bearing only
- âœ“ Low accuracy â†’ Show calibration hint
- âœ“ Airplane mode â†’ Permission flows work

---

## ğŸ“¦ Files Summary

| File | Purpose | Status |
|------|---------|--------|
| [app/(tabs)/index.tsx](app/(tabs)/index.tsx) | Home screen with unified modules grid | âœ… Updated |
| [app/qibla.tsx](app/qibla.tsx) | Qibla compass screen (MVP) | âœ… Created |
| [constants/translations.ts](constants/translations.ts) | EN/FR translations for Qibla | âœ… Updated |
| [HOME_SCREEN_QIBLA_IMPLEMENTATION.md](HOME_SCREEN_QIBLA_IMPLEMENTATION.md) | Implementation guide | âœ… Created |

**Total Lines Added:** ~680  
**Total Lines Changed:** ~80  
**New Dependencies:** 0 (uses existing packages)

---

## ğŸš€ Ready to Ship

All requirements met:
- âœ… Quick Access merged into Spiritual Modules
- âœ… Qibla feature implemented (MVP)
- âœ… Dark theme consistency
- âœ… SafeArea handling
- âœ… Translations (EN/FR)
- âœ… Error handling & loading states
- âœ… No duplicate tiles
- âœ… Responsive 3-column grid
- âœ… Smooth animations
- âœ… Permission flows
- âœ… No new dependencies

**Status: Production-ready** ğŸ‰
